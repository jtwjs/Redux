# Redux

**리덕스(Redux)** 는 Javascript app을 위한 상태관리 라이브러리이다.

리액트 뿐아니라 Angular, jQuery, vanila js등 다양한 framework와 작동되게 설계됨

즉, 리액트만을 위한 라이브러리가 아니다

컴포넌트들의 상태 관련 로직들을 다른 파일들로 분리시켜서 더욱 효율적으로 관리할수 있다.

추가적으로, 리덕스의 미들웨어라는 기능을 통하여 비동기 작업, 로깅 등의 확정적인 작업들을

더욱 쉽게 할수도 있게 해준다.

## 액션(Action)

리듀서(reducer)와 소통하는 방법으로 Object여야 하며 그 key 이름은 항상 type임

상태에 어떠한 변화가 필요하게 될 땐, 우리는 액션이란 것을 발생시킴

이는 하나의 객체로 표현되는데, 액션 객체는 다음과 같은 형식으로 이루어짐

```js
{
  type: "TOGGLE_VALUE";
}
```

액션 객체는 `type` key를 필수적으로 가지고 있어야하고 그외의 값들은

개발자 마음대로 넣기 가능

state를 수정할수 있는 유일한 방법은 action을 보내는 것!

### 액션 생성함수 (Action Creator)

액션 생성함수는 액션을 만드는 함수다.

단순히 파라미터를 받아와서 액션 객체 형태로 만들어 준다.

```js
function addToDo(data) {
  return {
    type: "ADD_TODO",
    data,
  };
}

//arrow function ex
const changeInput = (text) => ({
  type: "CHANGE_INPUT",
  text,
});
```

## 리듀서 (Reducer)

리듀서는 변화를 일으키는 함수이다.

리듀서는 두가지의 파라미터를 받아온다.

현재 상태의 application과 함께 불려지는 함수이다.(+ action)

application의 state를 반환한다.

```js
function reducer(state, action) {
  //상태 업데이트 로직
  return alteredState;
}
```

## 스토어 (Store)

리덕스에서는 한 애플리케이션 당 하나의 스토어(store)를 만들게 된다.

스토어(store) 안에는 현재의 앱 상태와, 리듀서(reducer)가 들어가있고, 추가적으로 몇가지 내장 함수들이 있다.

## 디스패치 (dispatch)

디스패치는 스토어(store)의 내장함수 중 하나이다.

디스패치는, 액션을 발생시키는 것이라고 이해하면 된다.

디스패치(dispatch)라는 함수에는 액션(action)을 파라미터로 전달한다.

그렇게 호출을 하면, 스토어(store)는 리듀서(reducer) 함수를 실행시켜서 해당 액션을 처리하는

로직이 있다면 액션을 참고하여 새로운 상태를 만들어준다.

## 구독 (subscribe)

구독 또한 스토어(store)의 내장함수 중 하나이다.

구독(subscribe)함수는 함수 형태의 값을 파라미터로 받아온다.

구독(subscribe) 함수에 특정 함수를 전달해주면, 액션이 디스패치(dispatch)

되었을 때 마다 전달해준 함수가 호출된다.

## combineReducers

> 리덕스 리듀서를 작성할 때 가장 일반적인 용례를 단순화 하는 유틸리티 함수

리덕스는 상태의 구성에 대해서는 관여하지 않지만 `combineReducers`는 일반적으로 발생하는 에러를 피하기 위해 몇가지 규칙을 강제한다.

리덕스가 액션을 디스패치 했을때 '모든 리듀서를 호출하는가?'는 루트 리듀서 함수는 오직 하나만 존재하기 때문에 이에 대한 대답은 '아니오'다.

`combineReducers`는 새로운 상태 트리를 조립하기 위해 상태의 부분과 현재 액션을 처리하는 각 슬라이스 리듀서를 호출하고, 필요하다면 슬라이스 리듀서에게 상태를 업데이트 할수 있게 한다.

그래서 `combineReducers`는 "모든 리듀서를 호출"하거나 래핑된 모든 슬라이스 리듀서를 호출한다.

`combineREducers`는 슬라이스 리듀서 함수들로 이루어진 객체를 취하며, 동일한 키를 가진 상태 객체를 출력하는 함수를 만든다.

```js
const rootReducer = combineReducers({
  todos: todosSlice.reducer, // 변수이름 대신 키 지정
});
```

## middleware

> 액션을 디스패치했을 떄 리듀서에게 이를 처리하기에 앞서 사전에 저장된 작업을 실행할 수 있게 해준다.

**액션과 리듀서 사이의 중간자** 라고 볼수 있다.

전달받은 액션을 단순히 콘솔에 기록하거나, 전달받은 액션 정보를 기반으로 액션을 아예 취소하거나, 다른 종류의 액션을 추가하는 등 다양한 역할을 담당 가능

```js
//미들웨어의 구조

const loggerMiddleware = (store) => (next) => (action) => {
  //기본 구조
};

export default loggerMiddleware;

const loggerMiddleware = function loggerMiddleware(store) {
  return function (next) {
    return function (action) {
      //기본 구조
    };
  };
};

export default loggerMiddleware;
```

결국 함수를 반환하는 함수를 반환하는 함수이다.

파라미터로 받아오는 store는 리덕스 스토어 인스턴스, action은 디스패치된 액션을 가리킨다.

미들웨어에서 사용되는 새로운 파라미터는 next인데, 이는 함수형태이며 store.dispatch와 비슷한 역할을 한다.

차이점은 next(action)을 통해 다음 처리해야 할 미들웨어에게 액션을 넘겨주고, 만약 그 다음 미들웨어가 없다면 리듀서에게 액션을 넘긴다.

### 리덕스 미들웨어가 필요한 이유

기존의 리덕스는 액션이 발생하게 되면, 디스패치를 통해 스토어에게 상태 변화의 필요성을 알리게 된다.

하지만, 디스패치된 액션을 스토어로 전달하기 전에 처리하고 싶은 작업이 있을 수 있다.

가령, 단순히 어떤 액션이 발생했는지 로그를 남길수도 있고, 액션을 취소해버리거나, 또 다른 액션을 발생시킬수 있다.

우리가 알고 있는 리덕스는 동기적인 흐름을 통해 동작한다.

액션 객체가 생성되고, 디스패치가 액션발생을 스토어게 알리면, 리듀서는 정해진 로직에 의해 액션을 처리한 후 새로운 상태값을 반환하는 과정이다.

하지만 동기적인 흐름만으로는 처리하기 힘든 작업들이 있따. 가령 시간을 딜레이시켜 동작하게 한다던지, 외부 데이터를 요청하여 그에 따른 응답을 화면에 보여주어야 한다면 어떻게 처리할까

리덕스는 이러한 비동기 작업을 처리하기 위해 지침을 알려주지 않고 있기 떄문에 이러한 비동기 작업을 처리하는데 있어 리덕스 미들웨어를 주로 사용한다.

#### 리덕스 미들웨어로 비동기 작업처리

리덕스 미들웨어로 비동기 작업을 수행해야 하는 경우는 매우 다양하다.

가령 presentational componenet에 API로 요청한 정보를 출력해야 하는 액션이 발생할 경우,

처리하는 시간이 필요하기 떄문에 이를 비동기 작업으로 수행하게 된다.

#### 기존 Redux flow

![redux-flow](https://user-images.githubusercontent.com/60641307/109119790-7e1cb400-7788-11eb-80b9-a3383fe78e74.png)

#### middleware flow

![redux-middleware-flow](https://user-images.githubusercontent.com/60641307/109119886-9ab8ec00-7788-11eb-80b1-6213a25d867e.png)

리덕스 미들웨어를 통해 비동기 작업을 처리할 떄 사용하는 미들웨어는 오픈 소스 커뮤니티에 많이 공개되어 있다.

대표적인 미들웨어로는 `redux-thunk`와 `redux-saga`가 있다.

- redux-thunk: 리덕스 창시자인 댄 아브라모프가 만든 가장 많이 사용되는 비동기 작업 미들웨어
- redux-saga: 전자 다음으로 가장 많이 사용되는 비동기 작업 미들웨어 라이브러리로, 특정 액션이 디스패치되었을 때 정해진 로직에 따라 다른 액션을 디스패치시키는 규칙을 작성하여 비동기 작업을 처리할수 있게 해준다.
